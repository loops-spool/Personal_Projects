<!DOCTYPE html>
   <head>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" type = "text/css" href="style.css/?version1">
   </head>
   <body class = "scaled">

      <form action = "/" method = "POST" id = "led settings" name = "led settings">

         <label for = "effect">Effects:</label>
         <br>
         <select name = "effect" id = "effect" onchange = "this.form.submit()">
            <option value = "Off">Off</option>
            <option value = "" disabled></option>

            <optgroup label = "Static Effects">
               <option value = "Single color">Single color</option>
               <option value = "Static alternating colors">Alternating colors</option>
            </optgroup>
            <option value = "" disabled></option>

            <optgroup label = "Animated Effects">
               <option value = "Animated alternating colors">Alternating colors</option>
               <option value = "Twinkle">Twinkle</option>
               <option value = "Random">Random</option>
            </optgroup>
         </select>
         <br>
         <br>

         <label for = "colors" id = "colors label" name = "colors label">Color:</label>
         <br>
         <div id = "colors">
            <input type = "color" name = "color0" id = "color0" value = "#FF4614" onchange = "this.form.submit()">
            <input type = "color" name = "color1" id = "color1" value = "#FF4614" visibility = "hidden" onchange = "this.form.submit()">
         </div>
         <br>

         <label for = "mult brightnesses checkbox" id = "mult brightnesses checkbox label" name = "mult brightnesses checkbox label" style = "display:none;">Enable multiple brightnesses</label>
         <input type = "checkbox" id = "mult brightnesses checkbox" name = "mult brightnesses checkbox" value = "True" style = "display:none;" onchange = "this.form.submit()">
         <br>
         <br>

         <label for = "brightness">Brightness:</label>
         <div>
            <input type = "range" min = "0" max = "100" value = "50" name = "brightness0" id = "brightness0" onchange="this.form.submit()">
            <input type = "range" min = "0" max = "100" value = "50" name = "brightness1" id = "brightness1" style = "display:none;" onchange="this.form.submit()">
            <input type = "range" min = "0" max = "100" value = "50" name = "brightness2" id = "brightness2"  style = "display:none;" onchange="this.form.submit()">
         </div>

         <script>
            const effect = document.getElementById("effect");
            const color0 = document.getElementById("color0");
            const color1 = document.getElementById("color1");
            const mult_brightnesses_checkbox = document.getElementById("mult brightnesses checkbox");
            const brightness0 = document.getElementById("brightness0");
            const brightness1 = document.getElementById("brightness1");
            const brightness2 = document.getElementById("brightness2");

            var form_elements = [
               effect,
               color0,
               color1,
               mult_brightnesses_checkbox,
               brightness0,
               brightness1,
               brightness2
            ];

            var form_elements_storage_name = [
               "effect",
               "color0",
               "color1",
               "mult brightnesses checkbox",
               "brightness0",
               "brightness1",
               "brightness2"
            ];

            // Saves form values across refreshes
            for(let i = 0; i < form_elements.length; i++)
            {
               // Saves value
               form_elements[i].addEventListener("change", function() {
                  // Since checkboxes don't have a value attribute, must use checked attribute
                  if (form_elements_storage_name[i] == "mult brightnesses checkbox")
                     localStorage.setItem(form_elements_storage_name[i], this.checked);
                  else
                     localStorage.setItem(form_elements_storage_name[i], this.value);
               });

               // Sets value
               let val = localStorage.getItem(form_elements_storage_name[i]);
               if (val) 
               {
                  // Since localStorage stores values only as strings
                  // Boolean values must be converted from a string back to boolean
                     // to be assigned to a checkbox checked attribute
                  if (form_elements_storage_name[i] == "mult brightnesses checkbox")
                     form_elements[i].checked = (val == 'true');
                  else
                     form_elements[i].value = val; 
               }
            }


            var effect_color_amounts = {
               "Off": 1,
               "Single color": 1,
               "Static alternating colors": 2,
               "Animated alternating colors": 2,
               "Twinkle": 1,
               "Random": 2
            };

            var has_mult_brightnesses = mult_brightnesses_checkbox.checked
            var mult_brightnesses_checkbox_label = document.getElementById("mult brightnesses checkbox label");
            var colors_label = document.getElementById("colors label");

            // This script shows multiple color selectors for the effect if needed
            switch (effect_color_amounts[effect.value])
            {
               case 1:
                  colors_label.style = "display:inline;";
                  color1.style.visibility = "hidden";
                  mult_brightnesses_checkbox.style = "display:none;";
                  mult_brightnesses__checkbox_label.style = "display:none;";
                  break;
               
               case 2:
                  colors_label.style = "display:inline;";
                  color1.style.visibility = "visible";
                  mult_brightnesses_checkbox_label.style = "display:inline;";
                  mult_brightnesses_checkbox.style = "display:inline;";

                  if (has_mult_brightnesses == true)
                     brightness1.style = "display:inline;";
                  else
                     brightness1.style = "display:none;";

                  break;

               case 3:
                  break;

               default:
                  colors_label.style = "display:inline;";
                  color1.style.visibility = "hidden";
                  mult_brightnesses_checkbox.style = "display:none;";
                  mult_brightnesses_checkbox_label.style = "display:none;";
                  break;
            }

            if (effect.value == "Random")
            {
               colors_label.style = "display:none;";
               color0.style.visibility = "hidden";
               color1.style.visibility = "hidden";
               mult_brightnesses_checkbox.style = "display:none;";
               mult_brightnesses_checkbox_label.style = "display:none;";
               brightness1.style = "display:none;";
            }
         </script>
         
      </form>
      
   </body>
</html>